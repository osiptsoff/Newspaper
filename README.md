# О проекте
Данный репозиторий содержит код, написанный в рамках задания "Новостная интернет-газета". <br>
Краткие требования:
1. в общем случае новости сортируются по дате публикации;
2. зарегистрированные пользователи могут оставлять комментарии к новостям, ставить лайки;
3. новости разделяются по тематике (тегам);
4. возможность публиковать изображения к новостям;
5. пользователи могут указывать любимые и запрещённые для себя теги;
6. возможность для пользователя получить новости с учётом своих предпочтений;
7. присутствует функционал администрирования;
8. авторизация с использованием JWT-токенов.

# Backend
## Документация API 
Примеры запросов и разные вариации ответов можно увидеть в [коллекции Postman](https://www.postman.com/osiptsoff/workspace/newspaper-api).<br>
Коллекцию можно использовать для тестирования.

## Запуск Docker-контейнера
### Образ
Образ [опубликован](https://hub.docker.com/repository/docker/osiptsoff/newspaperapp/general) в DockerHub.<br>
Используемая СУБД: PostgreSQL 14, JRE: openjdk8-jre.<br>
В томе `/log` хранятся логи работы приложения.

### Запуск
Получить образ из DockerHub: `docker pull osiptsoff/newspaperapp:1.1`.<br>
Приложение работает на 8080/tcp порте контейнера. Для связи с внешним миром нужно при запуске контейнера сопоставить порт со свободным портом хоста; 
таким образом, запуск может выглядеть так:<br> `docker run -p 8080:8080 osiptsoff/newspaperapp:1.1`.<br>
На данном этапе контейнер должен быть запущен, приложение готово к работе; при нужде исполнять команды в контейнере выполнить:<br> 
`docker exec -it id /bin/sh`, где id - ID работающего контейнера (можно узнать из `docker ps`).

### Тестовые данные
Изначально база данных пуста, однако в файловой системе контейнера можно найти дамп с тестовыми данными.<br>
Для обогащения базы ими нужно исполнить `psql -U postgres newspaperdb < /tmp/data.dump` в контейнере.<br>
Имеются зарегистрированные пользователи: Serge и Yury123 - пароль 12345 у обоих; администратор: admin, пароль pa$$w0rd.<p>
<b>Не рекомендуется использовать дамп для каких-либо целей кроме тестирования приложения.</b>

## Запуск из исходного кода
### Требования
1. СУБД - при разработке использовалась PostgreSQL, настройка будет рассматриваться только для неё;
2. JRE версии не старше 8.
### Настройка базы данных
1. Запустить консоль PostgreSQL, аутентифицироваться как суперпользователь СУБД: `sudo -u postgres psql`;
2. создать БД: исполнить `create database newspaperdb;`;
3. создать пользователя, от имени которого будет работать приложение, имя newspaperapp:<br> `create user newspaperapp with password '...';`, вместо ... указать пароль;
4. восстановить БД из дампа: `sudo -u postgres psql newspaperdb < newspaperdb.dump`, выйдя из консоли СУБД и находясь в одной папке с дампом.
### Настройка приложения
На основе app/src/main/resources/application.properties.origin создать файл application.properties по тому же пути, задать свойства (в формате ключ=значение):
1. ключ server.servlet.context-path - контекстный путь приложения, можно использовать значение `/api`;
2. server.port - порт, прослушиваемый приложением, можно использовать `8080`;
3. spring.datasource.url - url базы данных, если конфигурировать её точь-в-точь по руководству, то использовать `jdbc:postgresql://localhost:5432/newspaperdb`;
4. spring.datasource.username - имя пользователя БД, от которого будет работать приложение; если конфигурировать БД по руководству, то использовать `newspaperapp`;
5. spring.datasource.password - пароль пользователя БД, от имени которого будет работать приложение;
6. spring.servlet.multipart.max-file-size - максимальный размер загружаемого изображения, можно использовать `32MB`;
7. spring.servlet.multipart.max-request-size - максимальный размер запроса с изображением, можно использовать `32MB`;
8. logging.file.path - путь к директории, в которой будут создаваться логи работы приложения, можно использовать `log`;
9. logging.level.ru.spb.nicetu.newspaper.api.App - уровень логирования, можно использовать  `info`;
10. app.config.commentPageSize - максимальное число комментариев, возвращаемое за раз при запросе, можно использовать `3`;
11. app.config.textBlockPageSize - максимальное число блоков текста новости, возвращаемое за раз при запросе, можно использовать `5` (очень большие новости подгружаются по частям);
12. app.config.newsPageSize - максимальное число новостей, возвращаемое за раз при запросе, можно использовать `10`;
13. app.config.uploadDirectory - путь к директории, в которой будут храниться загружаемые изображения, можно использовать `images`;
14. app.config.security.accessSecret - base64-закодированный 256-битный ключ, которым подписываются access-токены;
  рекомендуется сгенерировать<br>(пользователи linux могут сделать это, выполнив команду `cat /dev/random | head -c 32 | base64`),
  однако <b>только для тестирования</b> можно использовать `yV1/pLoJbnqTYv4xTlFVuuDFt8bOtE+ig3frlN9TcgQ=`;
15. app.config.security.refreshSecret - base64-закодированный 256-битный ключ, которым подписываются refresh-токены;
  рекомендуется сгенерировать<br>(пользователи linux могут сделать это, выполнив команду `cat /dev/random | head -c 32 | base64`),
  однако <b>только для тестирования</b> можно использовать `NUpS9YYlwzoUIDHGPVw9Aoq4cN836E4XanOGNxgB5uI=`;
16. app.config.security.accessLifespawnSec - срок жизни access-токена, в секундах, желательно делать небольшим; можно использовать `300`;
17. app.config.security.refreshLifespawnSec - срок жизнт refresh-токена, в секундах, желательно делать минимум несколько дней; можно использовать `604800`;
18. app.config.security.defaultUserRole - роль для новых пользователей по умолчанию; возможны `user` (просмотр новостей и комментариев, лайки, фильтрация по тегам, оставление комментариев)
  или `admin` (возможности user + CRUD-операции над новостями и возможность удалить любой комментарий); рекомендуется использовать `user`;
19. app.config.security.clientUrl - url клиента, важен при определении CORS-политики; можно использовать `http://localhost:5173`.

### Запуск приложения
1. собрать проект, выполнив `./gradlew build` в папке проекта;
2. запустить проект, выполнив `./gradlew bootRun` в папке проекта.

# Frontend

TO_DO
